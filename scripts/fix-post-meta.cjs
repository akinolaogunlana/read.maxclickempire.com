// update-post-meta.js
const fs = require("fs");
const path = require("path");
const cheerio = require("cheerio");

const postsDir = path.join(__dirname, "..", "posts");
const outputPath = path.join(__dirname, "post-meta.js");

const postMetadata = {};

try {
  const files = fs.readdirSync(postsDir);

  files.forEach((file) => {
    if (!file.endsWith(".html")) return;

    const slug = file.replace(".html", "");
    const filePath = path.join(postsDir, file);
    const html = fs.readFileSync(filePath, "utf8");
    const $ = cheerio.load(html);

    const title = $("head title").text().trim();
    const description = $('meta[name="description"]').attr("content")?.trim() || "";
    const keywords = $('meta[name="keywords"]').attr("content")?.trim() || "";
    const ogImage = $('meta[property="og:image"]').attr("content")?.trim()
      || "https://read.maxclickempire.com/assets/og-image.jpg";

    if (!title || !description) {
      console.warn(`‚ö†Ô∏è Skipped ${file} due to missing title or description.`);
      return;
    }

    const stats = fs.statSync(filePath);
    const published = stats.birthtime.toISOString(); // üëà file creation time
    const modified = stats.mtime.toISOString();      // üëà last modified time

    postMetadata[slug] = {
      title,
      description,
      keywords,
      image: ogImage,
      published,
      modified
    };
  });

  // Output JavaScript
  const output = `// Auto-generated by Supreme SEO Engine ‚Äî Do Not Edit

const postMetadata = ${JSON.stringify(postMetadata, null, 2)};

if (typeof module !== 'undefined' && module.exports) {
  module.exports.postMetadata = postMetadata;
} else if (typeof window !== 'undefined') {
  window.postMetadata = postMetadata;
}
`;

  fs.writeFileSync(outputPath, output);
  console.log("‚úÖ post-meta.js updated successfully.");
} catch (err) {
  console.error("‚ùå Error updating post metadata:", err);
}