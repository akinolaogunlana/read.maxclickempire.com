// Auto-generated by Supreme SEO Engine
// This script wraps article HTML with the base template and injects dynamic metadata

const fs = require('fs');
const path = require('path');

// Load post metadata
const { postMetadata } = require('./data/post-meta.js');

// Load base HTML template
const template = fs.readFileSync('./template.html', 'utf8');

// Path to the output directory for final HTML posts
const outputDir = path.join(__dirname, 'public', 'posts');

// Ensure the output directory exists
fs.mkdirSync(outputDir, { recursive: true });

// Loop through each post in the metadata
for (const [slug, meta] of Object.entries(postMetadata)) {
  const sourceFile = path.join(__dirname, 'dist', `${slug}.html`);

  if (!fs.existsSync(sourceFile)) {
    console.warn(`⚠️  Source HTML not found: ${sourceFile}`);
    continue;
  }

  const rawContent = fs.readFileSync(sourceFile, 'utf8');

  // Generate JSON-LD structured data
  const structuredData = `
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "headline": "${meta.title}",
    "description": "${meta.description}",
    "image": "${meta.image}",
    "url": "https://read.maxclickempire.com/posts/${slug}.html",
    "datePublished": "${meta.published}",
    "author": {
      "@type": "Person",
      "name": "Ogunlana Akinola Okikiola"
    },
    "publisher": {
      "@type": "Organization",
      "name": "MaxClickEmpire",
      "logo": {
        "@type": "ImageObject",
        "url": "https://read.maxclickempire.com/assets/og-image.jpg"
      }
    }
  }
  </script>`.trim();

  // Replace template placeholders
  const finalHTML = template
    .replace(/{{TITLE}}/g, meta.title)
    .replace(/{{DESCRIPTION}}/g, meta.description)
    .replace(/{{KEYWORDS}}/g, slug.replace(/-/g, ', '))
    .replace(/{{FILENAME}}/g, slug)
    .replace(/{{STRUCTURED_DATA}}/g, structuredData)
    .replace(/{{CONTENT}}/g, rawContent);

  // Write the final HTML to the output directory
  const outputPath = path.join(outputDir, `${slug}.html`);
  fs.writeFileSync(outputPath, finalHTML, 'utf8');

  console.log(`✅ Wrapped: ${slug}.html`);
}